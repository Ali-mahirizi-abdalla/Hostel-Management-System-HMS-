{% extends 'hms/base.html' %}
{% load static %}

{% block title %}My Profile - Hostel Meal System{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">My Profile</h1>
    <p class="page-subtitle">Manage your account and preferences</p>
</div>

<div class="grid grid-3" style="grid-template-columns: 1fr 2fr;">
    <!-- Profile Card -->
    <div class="glass-card text-center" data-tilt>
        <div style="position: relative; display: inline-block; margin-bottom: 1.5rem;">
            {% if student.profile_picture %}
            <img src="{{ student.profile_picture.url }}" alt="Profile"
                style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 4px solid var(--glass-border);">
            {% else %}
            <img src="https://ui-avatars.com/api/?name={{ user.get_full_name|urlencode }}&background=6366f1&color=fff&size=150"
                alt="Profile"
                style="width: 150px; height: 150px; border-radius: 50%; border: 4px solid var(--glass-border);">
            {% endif %}

            <button onclick="document.getElementById('profile_pic_input').click()" class="btn btn-primary"
                style="position: absolute; bottom: 0; right: 0; padding: 0.5rem; border-radius: 50%; width: 40px; height: 40px;">
                ðŸ“·
            </button>
        </div>

        <h3 style="margin-bottom: 0.5rem;">{{ user.get_full_name|default:user.username }}</h3>
        <p class="text-muted" style="margin-bottom: 0.5rem;">{{ user.email }}</p>
        <div class="glass-card" style="display: inline-block; padding: 0.25rem 1rem; margin-bottom: 1.5rem;">
            Room {{ student.room_number }}
        </div>

        <form method="post" enctype="multipart/form-data" id="profile_pic_form" style="display: none;">
            {% csrf_token %}
            <input type="file" name="profile_picture" id="profile_pic_input" accept="image/*"
                onchange="document.getElementById('profile_pic_form').submit()">
            <input type="hidden" name="action" value="update_photo">
        </form>
    </div>

    <!-- Settings & Info -->
    <div class="glass-card">
        <div class="card-header">
            <h3 class="card-title">Personal Information</h3>
        </div>

        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="action" value="update_info">

            <div class="grid grid-2">
                <div class="form-group">
                    <label class="form-label">First Name</label>
                    <input type="text" name="first_name" class="form-input" value="{{ user.first_name }}">
                </div>
                <div class="form-group">
                    <label class="form-label">Last Name</label>
                    <input type="text" name="last_name" class="form-input" value="{{ user.last_name }}">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Phone Number</label>
                <input type="tel" name="phone_number" class="form-input" value="{{ student.phone_number }}">
            </div>

            <div class="form-group">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="default_early" name="default_early_breakfast" {%
                        if student.default_early_breakfast %}checked{% endif %}>
                    <label class="form-check-label" for="default_early">
                        Always request early breakfast by default
                    </label>
                </div>
            </div>

            <button type="submit" class="btn btn-primary">Save Changes</button>
        </form>

        <div style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid var(--glass-border);">
            <h4 style="margin-bottom: 1rem;">Change Password</h4>
            <a href="{% url 'hms:password_reset' %}" class="btn btn-secondary">Reset Password</a>
        </div>
    </div>
</div>
{% endblock %}